<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-status-bar-style" content="black"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width,target-densitydpi=160dpi,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui"> <meta name="format-detection" content="telephone=no"> <title>HappyFunTimes Redirector</title> <style>*{box-sizing:border-box;-moz-box-sizing:border-box}html,body{width:100%;height:100%;border:0;margin:0;padding:0;font-family:Helvetica,Arial,sans-serif;font-size:xx-large;font-weight:700;background-color:#666}h1{background:linear-gradient(to bottom,#f2f6f8 0,#d8e1e7 88%,#b5c6d0 91%,#e0eff9 100%);padding:.5em;border:10px solid #000;border-radius:2em;color:#000;padding:1em}.hidden{display:none}.progress>div{position:absolute;left:0;top:0;width:100%;min-height:100%;background-color:rgba(0,0,0,.7);display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:center;-webkit-align-content:center;-webkit-align-items:center;justify-content:center;align-content:center;align-items:center}.progress>div>div{background-color:#68F;color:#fff;padding:1em;border-radius:2em}.button-like{text-align:center;background-color:#CCC;color:#000;padding:.5em;border-radius:1em;margin-left:auto;margin-right:auto;margin-bottom:.5em;display:block}.progress-bar{width:100%;height:2em;border:10px solid #000;margin-bottom:1em}a{text-decoration:none;color:#000}#multiple-hfts{display:none}@keyframes animate-stripes{100%{background-position:-30px 0}}.progress-bar>div{height:100%;background-image:-webkit-linear-gradient(to left bottom,#CCC 0,#CCC 25%,#44F 25%,#44F 50%,#CCC 50%,#CCC 75%,#44F 75%);background-image:linear-gradient(to left bottom,#CCC 0,#CCC 25%,#44F 25%,#44F 50%,#CCC 50%,#CCC 75%,#44F 75%);background-size:30px 30px,100% 100%,100% 100%;box-shadow:inset 0 5px 5px 0 rgba(255,255,255,.4);animation:animate-stripes 1s linear infinite}@media only screen and (min-device-width :320px){html,body{font-size:small}blockquote{padding:0;margin:0;font-size:medium}.progress-bar{height:4em}.button-like{font-size:large}}@media only screen and (min-width :321px){html,body{font-size:xx-small}.progress-bar{display:none}blockquote{font-size:small}h1{font-size:small}}</style><script>/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
 * Copyright 2014, Gregg Tavares.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Gregg Tavares. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

(function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.slice(0,v.length-1).concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){var n=p.call(arguments,0);return typeof n[0]!="string"&&n.length===1&&n.push(null),s.apply(r,n.concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("almond.js",function(){}),n("cookies",[],function(){var e=function(e,t){var n=t||"/";this.set=function(t,r){var i="";if(r!==undefined){var s=new Date;s.setTime(Date.now()+r*24*60*60*1e3),i="; expires="+s.toGMTString()}var o=encodeURIComponent(e)+"="+encodeURIComponent(t)+i+"; path="+n;document.cookie=o},this.get=function(){var t=encodeURIComponent(e)+"=",n=document.cookie.split(";");for(var r=0;r<n.length;++r){var i=n[r];while(i.charAt(0)===" ")i=i.substring(1,i.length);if(i.indexOf(t)===0)return decodeURIComponent(i.substring(t.length,i.length))}},this.erase=function(){document.cookie=this.set(" ",-1)}};return e}),n("io",[],function(){var e=function(){},t=function(t,n,r,i){i=i||{};var s=new XMLHttpRequest;s.overrideMimeType&&s.overrideMimeType("text/plain");var o=i.timeout||0;s.timeout=o,e("set timeout to: "+s.timeout),s.open("POST",t,!0);var u=JSON.stringify(n),a=function(t,n){r&&(e("calling-callback:"+(t?" has error":"success")),r(t,n),r=undefined)},f=function(n){e("--error--",n),a("error sending json to "+t)},l=function(n){e("--timeout--",n),a("timeout sending json to "+t)},c=function(n){r&&(e("--forced timeout--",n),s.abort(),a("forced timeout sending json to "+t))},h=function(){e("--finish--");var n=undefined,r=s.status===200||s.status===0;if(r)try{n=JSON.parse(s.responseText)}catch(i){r=!1}a(r?null:"could not load: "+t,n)};try{o&&setTimeout(c,o+50),s.addEventListener("load",h,!1),s.addEventListener("timeout",l,!1),s.addEventListener("error",f,!1),s.setRequestHeader("Content-type","application/json"),s.send(u),e("--sent: "+t)}catch(p){e("--exception--"),setTimeout(function(){a("could not load: "+t,null)},0)}};return{sendJSON:t}}),n("iputils",[],function(){var e=window.webkitRTCPeerConnection||window.mozRTCPeerConnection,t={iceServers:[]},n=[],r=!1,i=[],s=2,o=["0.0.0.0","127.0.0.1"],u=function(e){if(o.indexOf(e)>=0)return;if(n.indexOf(e)>=0)return;n.push(e)},a=function(){if(s<=0){r=!0;for(var e=0;e<i.length;++e)i[e](n);i=[]}},f=function(e){e.split("\r\n").forEach(function(e){var t,n;if(~e.indexOf("a=candidate")){t=e.split(" "),n=t[4];var r=t[7];r==="host"&&u(n)}else~e.indexOf("c=")&&(t=e.split(" "),n=t[2],u(n))}),a()},l=function(){--s,a()};if(e){var c=new e(t);window.mozRTCPeerConnection&&c.createDataChannel("",{reliable:!1}),c.onicecandidate=function(e){e.candidate&&f(e.candidate.candidate),c.iceGatheringState==="complete"&&l()},c.createOffer(function(e){f(e.sdp),c.setLocalDescription(e),l()},function(){l()})}else s=0,a();var h=function(e){r?setTimeout(function(){e(n)},0):i.push(e)};return{getLocalIpAddresses:h}}),n("misc",[],function(){function t(e,t){e[0]==="?"&&(e=e.substring(1));var n=t||{};return e.split("&").forEach(function(e){var t=e.split("=").map(decodeURIComponent);n[t[0]]=t[1]!==undefined?t[1]:!0}),n}function n(e){return"?"+Object.keys(e).filter(function(t){return e[t]!==undefined}).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}var e=function(t,n){for(var r in t){if(!t.hasOwnProperty(r))continue;var i=t[r];if(i instanceof Array){var s=n[r];s||(s=[],n[r]=s),e(i,s)}else if(!(i instanceof Object)||i instanceof Function||i instanceof HTMLElement)n[r]=i;else{var s=n[r];s||(s={},n[r]=s),e(i,s)}}return n},r=function(e,n){var r=n||{};try{var i=e.indexOf("?"),s=e.indexOf("#");s<0&&(s=e.length);var o=e.substring(i+1,s);r=t(o,r)}catch(s){console.error(s)}return r},i=function(e){return t(window.location.search,e)},s=new RegExp("([a-zA-Z0-9_]+):","g"),o=function(t,n){var r=n||"settings",o=i(),u=t||{};if(o[r]){var a=o[r].replace(s,'"scripts/scanforserver.js":'),f=JSON.parse(a);e(f,u)}return u},u=function(e){return Math.floor(Math.random()*e)},a=function(){var e=u(3),t=[];for(var n=0;n<3;++n)t.push(u(128)+(n===e?128:64));return"rgb("+t.join(",")+")"},f=function(e){for(var t=0;t<document.styleSheets.length;++t){var n=document.styleSheets[t],r=n.cssRules||n.rules;if(r)for(var i=0;i<r.length;++i){var s=r[i];if(s.selectorText===e)return s}}},l=function(e){var t=document.createTextNode("");return e.appendChild(t),t},c=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=c(e.offsetParent);t.x+=n.x,t.y+=n.y}return t},h=function(e,t,n){return Math.max(t,Math.min(n,e))},p=function(e,t){return h(e,-t,t)},d=function(e){return e<0?-1:e>0?1:0},v=function(e,t){return Math.abs(e)<Math.abs(t)?e:t},m=function(e,t){return d(e)*(t-Math.min(t,Math.abs(e)))},g=function(e){return e*Math.PI/180},y=function(e){return e*180/Math.PI},b=function(e,t){var n=t?window.devicePixelRatio:1;n=n||1;var r=Math.floor(e.clientWidth*n),i=Math.floor(e.clientHeight*n);if(e.width!==r||e.height!==i)return e.width=r,e.height=i,!0};return{applyUrlSettings:o,clamp:h,clampPlusMinus:p,copyProperties:e,createTextNode:l,degToRad:g,findCSSStyleRule:f,getAbsolutePosition:c,invertPlusMinusRange:m,minToZero:v,objectToSearchString:n,parseUrlQuery:i,parseUrlQueryString:r,searchStringToObject:t,radToDeg:y,randInt:u,randCSSColor:a,resize:b,sign:d}}),n("progress",[],function(){var e=function(e){var t=document.createElement("div");e.appendChild(t),this.set=function(e){t.style.width=(Math.max(0,Math.min(1,e))*100|0)+"%"},this.set(0),this.show=function(t){e.style.display=t?"block":"none"}};return e}),n("strings",[],function(){var e=function(){var e={};return function(t,n){var r=e[t];if(!r||r.length<n)r=(new Array(n+1)).join(t),e[t]=r;return r}}(),t=function(e){return typeof e=="string"?e:e.toString()},n=function(n,r,i){n=t(n);if(n.length>=r)return n;var s=e(i,r);return n+s.substr(n.length-r)},r=function(n,r,i){n=t(n);if(n.length>=r)return n;var s=e(i,r);return s.substr(n.length-r)+n},i=function(){var e=/%\(([^\)]+)\)s/g;return function(t,n){return n.length||(n=[n]),t.replace(e,function(e,t){var r=t.split(".");for(var i=0;i<n.length;++i){var s=n[i];for(var o=0;o<r.length;++o){t=r[o],s=s[t];if(s===undefined)break}if(s!==undefined)return s}return console.error("unknown key: "+t),"%("+t+")s"})}}(),s=function(e,t){return e.length>=t.length&&e.substr(0,t.length)===t},o=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t},u=String.fromCodePoint?String.fromCodePoint:function(){var e=String.fromCharCode,t=Math.floor,n=function(){var n=16384,r=[],i,s,o=-1,u=arguments.length;if(!u)return"";var a="";while(++o<u){var f=Number(arguments[o]);if(!isFinite(f)||f<0||f>1114111||t(f)!==f)throw new RangeError("Invalid code point: "+f);f<=65535?r.push(f):(f-=65536,i=(f>>10)+55296,s=f%1024+56320,r.push(i,s));if(o+1===u||r.length>n)a+=e.apply(null,r),r.length=0}return a};return n}(),a={endsWith:o,fromCodePoint:u,padLeft:r,padRight:n,replaceParams:i,startsWith:s};return a}),e(["./cookies","./io","./iputils","./misc","./progress","./strings"],function(e,t,n,r,i,s){var o=document.getElementById.bind(document),u=r.parseUrlQuery(),a=u.debug||u.verbose?console.log.bind(console):function(){},f=window.location.origin+"/api/getgames";u.debug&&(f="http://localhost:1337/api/getgames"),u.local&&(f="http://local.happyfuntimes.net/api/getgames");var l=new e("name"),c=1,h=u.debug?5:254,p=0,d=4,v=2e3,m=18679,g=!1,y=u.cordovaurl!==undefined,b=[],w=[],E=0,S=0,x=new i(o("scan-progress"));x.show(!0),o("try").href=window.location.href,y&&(o("about").style.display="none");var T=function(){Array.prototype.forEach.call(document.querySelectorAll(".hidden"),function(e){e.style.display="block"})},N=function(){++S,--p,x.set(S/E),!g&&S>=E&&T()},C=function(e,t){a("hft response: "+JSON.stringify(t));if(e){console.error(e),k();return}O(t)},k=function(){u.scan?n.getLocalIpAddresses(_):T()},L=function(e){var t=l.get()||"";return e+"/enter-name.html"+r.objectToSearchString({fromHFTNet:!0,name:t,cordovaurl:u.cordovaurl,restarturl:u.restarturl,origin:window.location.href})},A=function(e){return L("http://"+e.ipAddress)},O=function(e){var t=[],n={},r=0,i=function(){if(r===e.length){x.show(!1),t.length===0?k():t.length===1?B(A(t[0])):M(t);return}var s=e[r++];q(s,function(s){return a("ping hft: "+s),function(o,u){if(!o){var a=u.serverName,f=!0;a&&(n[a]?f=!1:n[a]=!0),f&&t.push({ipAddress:s,data:u})}x.set(r/e.length),i()}}(s))};i()},M=function(e){a("ask player to choose hft: "+JSON.stringify(e,undefined,"  ")),o("looking").style.display="none";var t=o("hft-button-template").text,n=e.map(function(e,n){return s.replaceParams(t,{id:"game-"+n,url:A(e),name:e.data.serverName||"*unknown*",ipAddress:u.verbose?e.ipAddress:""})});o("multiple-hfts").style.display="block",o("systems").innerHTML=n.join("\n")};a("checking: "+f),t.sendJSON(f,{},C,{timeout:5e3});var _=function(e){e&&H(e),P()},D=["192.168.0.0","192.168.1.0","192.168.2.0","192.168.10.0","192.168.11.0","10.0.0.0","10.0.1.0","192.168.20.0","192.168.30.0","192.168.50.0","192.168.62.0","192.168.100.0","192.168.101.0","192.168.4.0","192.168.8.0","192.168.123.0","192.168.254.0"];u.debug&&(D=["192.168.0.0","10.0.0.0","192.168.123.0"]);var P=function(){var e=[1,2,3,10,11,12,20,21,22,50,51,52,100,101,102,150,151,152,200,201,202];D.forEach(function(t){e.forEach(function(e){b.push(t.replace(/\d+$/,e)),++E})}),U()},H=function(e){a("addFullScan: "+e),e.forEach(function(e){for(var t=c;t<=h;++t)w.push(e.replace(/\d+$/,t)),++E}),U()},B=function(e){g=!0,a("**GOTO** url: "+e),!u.debug&&u.go!==!1&&u.go!=="false"&&(window.location.href=e)},j=function(e){B(L(e))},F=function(e,t){var n=Date.now();return function(r,i){N();if(g)return;if(r){var s=Date.now(),o=s-n;if(o<v*.8){a("fastScan: "+t+" got fast response");var u=t.replace(/\.\d+$/,".");b=b.filter(function(e){var t=e.substring(0,u.length)!==u;return t||N(),t}),H([t])}else U()}else j(e,i)}},I=function(e,t){return function(n,r){N();if(g)return;n?(a("fullScan: "+t+" failed"),U()):j(e,r)}},q=function(e,n){var r="http://"+e;t.sendJSON(r,{cmd:"happyFunTimesPing"},function(e,t){e||(t.version!=="0.0.0"?e="bad api version: "+t.version:t.id!=="HappyFunTimes"&&(e="bad id: "+t.id)),n(e,t)},{timeout:v})},R=function(e,t){++p;var n=e+":"+m;q(n,t("http://"+n,e))},U=function(){w.length?(a("fullScan: "+w[0]),R(w.shift(),I)):b.length&&(a("fastScan: "+b[0]),R(b.shift(),F)),p<d&&(b.length||w.length)&&U()}}),n("scanforserver.js",function(){}),t(["scanforserver.js"])})();</script> <script id="hft-button-template" type="not-js"><a class="button-like" href="%(url)s">%(name)s%(ipAddress)s</a></script> </head> <body> <div class="progress" id="unity3d-msg"> <div> <div id="looking"> <h1>Looking for HappyFunTimes</h1> <blockquote> <div class="progress-bar" id="scan-progress"></div> <div class="hidden"> <p> Could not find HappyFunTimes &#9785; </p> <p> Are you sure you're connected to the same WiFi as the game? </p> </div> </blockquote> <div class="hidden"> <a class="button-like" href="/" id="try">Try Again</a> <div> &nbsp; </div> <a class="button-like" href="http://superhappyfuntimes.net/about/" target="_blank" id="about">What is this?</a> </div> </div> <div id="multiple-hfts"> <h1>Choose A System</h1> <div id="systems"> </div> </div> </div> </div> </body> </html>